from datetime import datetime, timedelta

schedule = {
    "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫": {
        "8.30-9.50": [
            [["1-2 –ª–µ–∫—Ü–∏—è"], "–ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–¥–æ—Ü. –ö–Ω–∞—Ç—å–∫–æ –Æ.–ò."],
            [["4-9 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è", "11-13 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∏–≥—Ä–æ–≤–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n—Å—Ç. –ø—Ä–µ–ø. –ë–∞–π–∫–æ –ê.–ü."],
            [["15-17 —Å–µ–º–∏–Ω–∞—Ä"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."]
        ],
        "10.05-11.25": [
            [["1-7 –ª–µ–∫—Ü–∏—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∏–≥—Ä–æ–≤–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n–ø—Ä–æ—Ñ. –ö–æ–∑–ª–æ–≤—Å–∫–∞—è –õ.–ò."],
            [["8-16 –ª–µ–∫—Ü–∏—è"], "–û–±—â–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ì—É–¥–∑–µ–Ω–∫–æ –õ.–ì."]
        ],
        "12.00-13.20": [
            [["2-3 –ª–µ–∫—Ü–∏—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —à–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ö–∏—Ä–∏—á–µ–Ω–∫–æ –ê.–ì."],
            [["4-17 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"],
             "–†–µ–∂–∏—Å—Å—É—Ä–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–¥–æ—Å—É–≥–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ê—Å—Ç—Ä–µ–¥–∏–Ω–æ–≤–∞ –†.–ù.\n–ø—Ä–µ–ø. –ò–æ–≤–ª–µ–≤–∞ –Æ.–Æ."]
        ],
        "13.35-14.55": [
            [["6-17 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"],
             "–†–µ–∂–∏—Å—Å—É—Ä–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–¥–æ—Å—É–≥–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ê—Å—Ç—Ä–µ–¥–∏–Ω–æ–≤–∞ –†.–ù.\n–ø—Ä–µ–ø. –ò–æ–≤–ª–µ–≤–∞ –Æ.–Æ."]
        ]
    },
    "–≤—Ç–æ—Ä–Ω–∏–∫": {
        "8.30-9.50": [
            [["2-3 –ª–µ–∫—Ü–∏—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —à–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ö–∏—Ä–∏—á–µ–Ω–∫–æ –ê.–ì."],
            [["10-14 —Å–µ–º–∏–Ω–∞—Ä"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ö–æ–≤–∞–ª—å—á—É–∫ –õ.–°."],
            [["15-16 —Å–µ–º–∏–Ω–∞—Ä"], "–û—Å–Ω–æ–≤—ã –ø—Ä–∞–≤–∞\n–¥–æ—Ü. –ê–¥–∞–º—é–∫ –û.–ò."]
        ],
        "10.05-11.25": [
            [["1-3 –ª–µ–∫—Ü–∏—è"], "–ú–∏—Ä–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞\n–ø—Ä–æ—Ñ. –ë—É–ª–∞—Ü–∫–∞—è –ù.–ê."],
            [["4-14 –ª–µ–∫—Ü–∏—è"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ö–æ–≤–∞–ª—å—á—É–∫ –õ.–°."],
            [["15-17 —Å–µ–º–∏–Ω–∞—Ä"], "–ú–∏—Ä–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞\n–ø—Ä–æ—Ñ. –ë—É–ª–∞—Ü–∫–∞—è –ù.–ê."]
        ],
        "12.00-13.20": [
            [["1-2 –ª–µ–∫—Ü–∏—è"], "–ú–∏—Ä–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞\n–ø—Ä–æ—Ñ. –ë—É–ª–∞—Ü–∫–∞—è –ù.–ê."],
            [["5-15 –ª–µ–∫—Ü–∏—è", "16 —Å–µ–º–∏–Ω–∞—Ä"], "–û—Å–Ω–æ–≤—ã –ø—Ä–∞–≤–∞\n–¥–æ—Ü. –ê–¥–∞–º—é–∫ –û.–ò."],
            [["3-13 –ª–µ–∫—Ü–∏—è", "14-16 —Å–µ–º–∏–Ω–∞—Ä"], "–°–æ—Ü–∏–æ–ª–æ–≥–∏—è\n–ø—Ä–æ—Ñ. –ë–µ–∑–Ω—é–∫ –î.–ö."]
        ]
    },
    "—Å—Ä–µ–¥–∞": {
        "8.30-9.50": [
            [["3-8 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —à–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ö–∏—Ä–∏—á–µ–Ω–∫–æ –ê.–ì."],
            [["12-13 —Å–µ–º–∏–Ω–∞—Ä"], "–≠—Ç–Ω–æ–∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–ø—Ä–æ—Ñ. –°–º–æ–ª–∏–∫ –ê.–ò."],
            [["14-16 —Å–µ–º–∏–Ω–∞—Ä"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."]
        ],
        "10.05-11.25": [
            [["1-11 –ª–µ–∫—Ü–∏—è"], "–ú–∏—Ä–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞\n–ø—Ä–æ—Ñ. –ë—É–ª–∞—Ü–∫–∞—è –ù.–ê."],
            [["12-13 –ª–µ–∫—Ü–∏—è"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."],
            [["14-16 —Å–µ–º–∏–Ω–∞—Ä"], "–≠—Ç–Ω–æ–∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–ø—Ä–æ—Ñ. –°–º–æ–ª–∏–∫ –ê.–ò."]
        ],
        "12.00-13.20": [
            [["1-2 –ª–µ–∫—Ü–∏—è"], "–≠—Ç–Ω–æ–∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–ø—Ä–æ—Ñ. –°–º–æ–ª–∏–∫ –ê.–ò."],
            [["3-5 –ª–µ–∫—Ü–∏—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∏–≥—Ä–æ–≤–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n–ø—Ä–æ—Ñ. –ö–æ–∑–ª–æ–≤—Å–∫–∞—è –õ.–ò."],
            [["9-10 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —à–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ö–∏—Ä–∏—á–µ–Ω–∫–æ –ê.–ì."],
            [["11-16 —Å–µ–º–∏–Ω–∞—Ä"], "–ú–∏—Ä–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞\n–ø—Ä–æ—Ñ. –ë—É–ª–∞—Ü–∫–∞—è –ù.–ê."]
        ]
    },
    "—á–µ—Ç–≤–µ—Ä–≥": {
        "8.30-9.50": [
            [["14-17 —Å–µ–º–∏–Ω–∞—Ä"], "–û–±—â–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ì—É–¥–∑–µ–Ω–∫–æ –õ.–ì."]
        ],
        "10.05-11.25": [
            [["1-2 –ª–µ–∫—Ü–∏—è"], "–û–±—â–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ì—É–¥–∑–µ–Ω–∫–æ –õ.–ì."],
            [["3-9 –ª–µ–∫—Ü–∏—è", "11-13 –ª–µ–∫—Ü–∏—è"], "–≠—Ç–Ω–æ–∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–ø—Ä–æ—Ñ. –°–º–æ–ª–∏–∫ –ê.–ò."],
            [["14-15 –ª–µ–∫—Ü–∏—è"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."]
        ],
        "12.00-13.20": [
            [["1-3 –ª–µ–∫—Ü–∏—è"], "–≠—Ç–Ω–æ–∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–ø—Ä–æ—Ñ. –°–º–æ–ª–∏–∫ –ê.–ò."],
            [["13-14 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è", "16-17 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"],
             "–†–µ–∂–∏—Å—Å—É—Ä–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–¥–æ—Å—É–≥–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ê—Å—Ç—Ä–µ–¥–∏–Ω–æ–≤–∞ –†.–ù.\n–ø—Ä–µ–ø. –ò–æ–≤–ª–µ–≤–∞ –Æ.–Æ."],
            [["15 —Å–µ–º–∏–Ω–∞—Ä"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."],
            [["16 —Å–µ–º–∏–Ω–∞—Ä"], "–¢–µ–æ—Ä–∏—è, –∏—Å—Ç–æ—Ä–∏—è –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ-–∫—É–ª—å—Ç—É—Ä–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n–ø—Ä–æ—Ñ. –ú–∞–∫–∞—Ä–æ–≤–∞ –ï.–ê."]
        ]
    },
    "–ø—è—Ç–Ω–∏—Ü–∞": {
        "8.30-9.50": [
            [["2 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∏–≥—Ä–æ–≤–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n—Å—Ç. –ø—Ä–µ–ø. –ë–∞–π–∫–æ –ê.–ü."],
            [["6-9 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è", "11-15 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è", "17 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"],
             "–†–µ–∂–∏—Å—Å—É—Ä–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–¥–æ—Å—É–≥–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ê—Å—Ç—Ä–µ–¥–∏–Ω–æ–≤–∞ –†.–ù.\n–ø—Ä–µ–ø. –ò–æ–≤–ª–µ–≤–∞ –Æ.–Æ."]
        ],
        "10.05-11.25": [
            [["1-2 –ª–µ–∫—Ü–∏—è"], "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —à–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ö–∏—Ä–∏—á–µ–Ω–∫–æ –ê.–ì."],
            [["3 –ª–µ–∫—Ü–∏—è"], "–û–±—â–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ì—É–¥–∑–µ–Ω–∫–æ –õ.–ì."],
            [["4-9 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è", "11-15 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è", "17 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è"],
             "–†–µ–∂–∏—Å—Å—É—Ä–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–¥–æ—Å—É–≥–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º\n—Å—Ç. –ø—Ä–µ–ø. –ê—Å—Ç—Ä–µ–¥–∏–Ω–æ–≤–∞ –†.–ù.\n–ø—Ä–µ–ø. –ò–æ–≤–ª–µ–≤–∞ –Æ.–Æ."],
            [["16 –ª–µ–∫—Ü–∏—è"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."]
        ],
        "12.00-13.20": [
            [["1-2 –ª–µ–∫—Ü–∏—è"], "–û–±—â–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ì—É–¥–∑–µ–Ω–∫–æ –õ.–ì."],
            [["13-14 —Å–µ–º–∏–Ω–∞—Ä"], "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç—ç–∫–æ–Ω–æ–º–∏—è\n–ø—Ä–æ—Ñ. –Ø–∑—ã–∫–æ–≤–∏—á –í.–†."]
        ]
    },
    "—Å—É–±–±–æ—Ç–∞": {
        "10.05-11.25": [
            [["5-6 –ª–µ–∫—Ü–∏—è"], "–û–±—â–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n—Å—Ç. –ø—Ä–µ–ø. –ì—É–¥–∑–µ–Ω–∫–æ –õ.–ì."]
        ],
        "12.00-13.20": [
            [["1-9 –ª–µ–∫—Ü–∏—è", "11 –ª–µ–∫—Ü–∏—è", "12-14 —Å–µ–º–∏–Ω–∞—Ä"], "–ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–¥–æ—Ü. –ö–Ω–∞—Ç—å–∫–æ –Æ.–ò."]
        ],
        "13.35-14.55": [
            [["1-9 –ª–µ–∫—Ü–∏—è", "11 –ª–µ–∫—Ü–∏—è", "12-14 —Å–µ–º–∏–Ω–∞—Ä"], "–ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è\n–¥–æ—Ü. –ö–Ω–∞—Ç—å–∫–æ –Æ.–ò."]
        ]
    }
}

day_name_russian_map = {
    "monday": "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
    "tuesday": "–≤—Ç–æ—Ä–Ω–∏–∫",
    "wednesday": "—Å—Ä–µ–¥–∞",
    "thursday": "—á–µ—Ç–≤–µ—Ä–≥",
    "friday": "–ø—è—Ç–Ω–∏—Ü–∞",
    "saturday": "—Å—É–±–±–æ—Ç–∞",
}

start_date = datetime(2024, 9, 2)


def get_week_number(date):
    return ((date - start_date).days // 7) + 1


def filter_lectures(lectures, week_number):
    result = []
    for lecture in lectures:
        week_ranges = lecture[0]
        for week_range in week_ranges:
            wr, tp = week_range.split()
            if '-' in wr:
                start, end = map(int, wr.split('-'))
                if start <= week_number <= end:
                    result.append(f'{lecture[1]}({tp})')

            else:
                if int(wr) == week_number:
                    result.append(f'{lecture[1]}\n{tp}')
    return result


def get_current_week_monday():
    today = datetime.now()
    current_weekday = today.weekday()
    monday = today - timedelta(days=current_weekday)
    return monday


def get_schedule_message_for_week(next_week=False):
    monday = get_current_week_monday()
    current_week_number = get_week_number(monday)
    if next_week:
        current_week_number += 1
    msg = f'üìÜ #—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ {current_week_number} —É—á–µ–±–Ω—É—é –Ω–µ–¥–µ–ª—é\n'
    for i in range(6):
        day = monday + timedelta(days=i)
        day_name = day.strftime("%A").lower()
        if next_week:
            day += timedelta(days=7)

        day_name_russian = day_name_russian_map[day_name]
        color_point = ''
        match day_name_russian:
            case '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫':
                color_point = 'üü°'
            case '–≤—Ç–æ—Ä–Ω–∏–∫':
                color_point = 'üü¢'
            case '—Å—Ä–µ–¥–∞':
                color_point = 'üîµ'
            case '—á–µ—Ç–≤–µ—Ä–≥':
                color_point = 'üü†'
            case '–ø—è—Ç–Ω–∏—Ü–∞':
                color_point = 'üü£'
            case '—Å—É–±–±–æ—Ç–∞':
                color_point = 'üî¥'
        msg += f"\n{color_point} <b>{day_name_russian.upper()}({day.strftime('%d.%m')})</b>\n\n"

        if day_name_russian in schedule:
            for time, lectures in schedule[day_name_russian].items():
                filtered_lectures = filter_lectures(lectures, current_week_number)
                if filtered_lectures:
                    msg += f"<b>{time}:</b>\n"
                    for lecture in filtered_lectures:
                        msg += f"{lecture}\n"

    return msg
